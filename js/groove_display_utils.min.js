var constant_MAX_MEASURES=10,constant_DEFAULT_TEMPO=80,constant_ABC_STICK_R='"R"x',constant_ABC_STICK_L='"L"x',constant_ABC_STICK_BOTH='"R/L"x',constant_ABC_STICK_COUNT='"count"x',constant_ABC_STICK_OFF='""x',constant_ABC_HH_Ride="^A'",constant_ABC_HH_Ride_Bell="^B'",constant_ABC_HH_Cow_Bell="^D'",constant_ABC_HH_Crash="^c'",constant_ABC_HH_Stacker="^d'",constant_ABC_HH_Metronome_Normal="^e'",constant_ABC_HH_Metronome_Accent="^f'",constant_ABC_HH_Open="!open!^g",constant_ABC_HH_Close="!plus!^g",constant_ABC_HH_Accent="!accent!^g",constant_ABC_HH_Normal="^g",constant_ABC_SN_Ghost="!(.!!).!c",constant_ABC_SN_Accent="!accent!c",constant_ABC_SN_Normal="c",constant_ABC_SN_XStick="^c",constant_ABC_SN_Buzz="!///!c",constant_ABC_SN_Flam="!accent!{/c}c",constant_ABC_SN_Drag="{/cc}c",constant_ABC_KI_SandK="[F^d,]",constant_ABC_KI_Splash="^d,",constant_ABC_KI_Normal="F",constant_ABC_T1_Normal="e",constant_ABC_T2_Normal="d",constant_ABC_T3_Normal="B",constant_ABC_T4_Normal="A",constant_NUMBER_OF_TOMS=4,constant_ABC_OFF=!1;class MeasureText{constructor(e,t,r){this.measure=e,this.begin=t,this.text=r}}class SVGLibCallback{constructor(){this.abc_svg_output="",this.abc_error_output="",this.read_file=function(e){return""},this.errmsg=function(e,t,r){this.abc_error_output+=e+"<br/>\n"},this.svg_highlight_y=0,this.svg_highlight_h=44,this.img_out=function(e){this.abc_svg_output+=e},this.page_format=!0}}class GrooveData{constructor(){this.notesPerMeasure=16,this.timeDivision=16,this.numberOfMeasures=1,this.numBeats=4,this.noteValue=4,this.class_empty_note_array=[!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],this.sticking_array=this.class_empty_note_array.slice(0),this.hh_array=this.class_empty_note_array.slice(0),this.snare_array=this.class_empty_note_array.slice(0),this.kick_array=this.class_empty_note_array.slice(0),this.toms_array=[this.class_empty_note_array.slice(0),this.class_empty_note_array.slice(0),this.class_empty_note_array.slice(0),this.class_empty_note_array.slice(0)],this.showToms=!1,this.showStickings=!1,this.title="",this.author="",this.comments="",this.showLegend=!1,this.tempo=constant_DEFAULT_TEMPO,this.kickStemsUp=!0,this.debugMode=this.debugMode,this.grooveDBAuthoring=this.grooveDBAuthoring,this.viewMode=this.viewMode,this.repeatBegins=[],this.repeatEnds=[],this.repeatEndings=new Map,this.measureText=new Map}}class GrooveUtils{constructor(){this.abc_obj=null,this.note_mapping_array=null,this.debugMode=!1,this.viewMode=!0,this.grooveDBAuthoring=!1,this.isLegendVisable=!1,this.noteCallback=null,this.playEventCallback=null,this.repeatCallback=null,this.tempoChangeCallback=null,this.visible_context_menu=!1,this.myGrooveData=new GrooveData,this.abcToSVGCallback=new SVGLibCallback}getQueryVariableFromString(e,t,r){for(var s=r.substring(1).split("&"),a=0;a<s.length;a++){var n=s[a].split("=");if(n[0].toLowerCase()==e.toLowerCase())return n[1]}return t}calc_notes_per_measure(e,t,r){return e/r*t}isTripletDivision(e){return e%12==0}isTripletDivisionFromNotesPerMeasure(e,t,r){return this.isTripletDivision(e/t*r)}GetEmptyGroove(e,t){var r,s="",a="|";for(r=0;r<e;r++)a+="-";for(r=0;r<t;r++)s+=a;return s+"|"}GetDefaultStickingsGroove(e,t,r,s){return this.GetEmptyGroove(e,s)}GetDefaultHHGroove(e,t,r,s){var a,n="",o="|";for(a=0;a<e;a++)48==e?o+="-":o+="x";for(a=0;a<s;a++)n+=o;return n+"|"}GetDefaultTom1Groove(e,t,r,s){return this.GetEmptyGroove(e,s)}GetDefaultTom4Groove(e,t,r,s){return this.GetEmptyGroove(e,s)}GetDefaultSnareGroove(e,t,r,s){var a,n="",o="|",i=e/t;for(a=0;a<e;a++)a%i==0&&a/i%2!=0?o+="O":o+="-";for(a=0;a<s;a++)n+=o;return n+"|"}GetDefaultKickGroove(e,t,r,s){var a,n="",o="|",i=e/t;for(a=0;a<e;a++)a%i==0&&a/i%2==0?o+="o":o+="-";for(a=0;a<s;a++)n+=o;return n+"|"}GetDefaultTomGroove(e,t,r,s){return this.GetEmptyGroove(e,s)}tablatureToABCNotationPerNote(e,t){switch(t){case"b":case"B":if("Stickings"==e)return constant_ABC_STICK_BOTH;if("H"==e)return constant_ABC_HH_Ride_Bell;if("S"==e)return constant_ABC_SN_Buzz;break;case"c":if("Stickings"==e)return constant_ABC_STICK_COUNT;if("H"==e)return constant_ABC_HH_Crash;break;case"d":if("S"==e)return constant_ABC_SN_Drag;break;case"f":if("S"==e)return constant_ABC_SN_Flam;break;case"g":if("S"==e)return constant_ABC_SN_Ghost;break;case"l":case"L":if("Stickings"==e)return constant_ABC_STICK_L;break;case"m":if("H"==e)return constant_ABC_HH_Cow_Bell;break;case"n":if("H"==e)return constant_ABC_HH_Metronome_Normal;break;case"N":if("H"==e)return constant_ABC_HH_Metronome_Accent;break;case"O":if("S"==e)return constant_ABC_SN_Accent;break;case"o":switch(e){case"H":return constant_ABC_HH_Open;case"S":return constant_ABC_SN_Normal;case"K":case"B":return constant_ABC_KI_Normal;case"T1":return constant_ABC_T1_Normal;case"T2":return constant_ABC_T2_Normal;case"T3":return constant_ABC_T3_Normal;case"T4":return constant_ABC_T4_Normal}break;case"r":case"R":switch(e){case"H":return constant_ABC_HH_Ride;case"Stickings":return constant_ABC_STICK_R}break;case"s":if("H"==e)return constant_ABC_HH_Stacker;break;case"x":switch(e){case"S":return constant_ABC_SN_XStick;case"K":case"B":return constant_ABC_KI_Splash;case"H":return constant_ABC_HH_Normal;case"T1":return constant_ABC_T1_Normal;case"T4":return constant_ABC_T4_Normal}break;case"X":switch(e){case"K":return constant_ABC_KI_SandK;case"H":return constant_ABC_HH_Accent}break;case"+":if("H"==e)return constant_ABC_HH_Close;break;case"-":return!1}return console.log("Bad tablature note found in tablatureToABCNotationPerNote.  Tab: "+t+" for drum type: "+e),!1}abcNotationToTablaturePerNote(e,t){var r="-";switch(t){case constant_ABC_STICK_R:r="R";break;case constant_ABC_STICK_L:r="L";break;case constant_ABC_STICK_BOTH:r="B";break;case constant_ABC_STICK_OFF:r="-";break;case constant_ABC_STICK_COUNT:r="c";break;case constant_ABC_HH_Ride:r="r";break;case constant_ABC_HH_Ride_Bell:r="b";break;case constant_ABC_HH_Cow_Bell:r="m";break;case constant_ABC_HH_Crash:r="c";break;case constant_ABC_HH_Stacker:r="s";break;case constant_ABC_HH_Metronome_Normal:r="n";break;case constant_ABC_HH_Metronome_Accent:r="N";break;case constant_ABC_HH_Open:r="o";break;case constant_ABC_HH_Close:r="+";break;case constant_ABC_SN_Accent:r="O";break;case constant_ABC_SN_Buzz:r="b";break;case constant_ABC_HH_Normal:case constant_ABC_SN_XStick:r="x";break;case constant_ABC_SN_Ghost:r="g";break;case constant_ABC_SN_Normal:case constant_ABC_KI_Normal:case constant_ABC_T1_Normal:case constant_ABC_T2_Normal:case constant_ABC_T3_Normal:case constant_ABC_T4_Normal:r="o";break;case constant_ABC_SN_Flam:r="f";break;case constant_ABC_SN_Drag:r="d";break;case constant_ABC_HH_Accent:case constant_ABC_KI_SandK:r="X";break;case constant_ABC_KI_Splash:r="x";break;case constant_ABC_OFF:r="-";break;default:console.log("bad case in abcNotationToTablaturePerNote: "+t)}return r}noteArraysFromURLData(e,t,r,s){var a=[];t=decodeURIComponent(t);var n=r*s,o=t.replace(/\:|\!|\)|\(|\[|\]|\|/g,""),i=1,c=1;o.length>n&&o.length/n>=2?i=Math.ceil(o.length/n):o.length<n&&n/o.length>=2&&(c=Math.ceil(n/o.length));for(var u=0;u<n;u++)a[u]=!1;for(var h=0,l=0;l<o.length&&h<n;l+=i,h+=c)a[h]=this.tablatureToABCNotationPerNote(e,o[l]);return a}tabLineFromAbcNoteArray(e,t,r,s,a,n){var o="";a>t.length&&(a=t.length);for(var i=0;i<a;i++){var c=abcNotationToTablaturePerNote(e,t[i]);"H"==e&&"X"==c?r?o+=c:o+="-":("K"==e||"S"==e)&&("o"==c||"O"==c)?r?o+=c:o+="-":"K"==e&&"X"==c?r&&s?o+="X":r?o+="o":o+="x":s?o+=c:o+="-",n>0&&(i+1)%n==0&&(o+="|")}return o}parseTimeSigString(e){var t=e.split("/");if(2!=t.length)return[4,4];var r=parseInt(t[0],10),s=parseInt(t[1],10);return(r<1||r>32)&&(r=4),2!=s&&4!=s&&8!=s&&16!=s&&(s=4),[r,s]}parseIntSet(e){if(""===e)return new Set;var t=e.split(";");return new Set(t.map(e=>parseInt(e)))}parseMeasureMapping(e){if(""===e)return new Map;var t=e.split(";"),r=new Map;return t.forEach(e=>{var t=e.split(":");r.set(parseInt(t[0]),t[1])}),r}parseTextMapping(e){if(""===e)return new Map;var t=e.split(";"),r=new Map;return t.forEach(e=>{var t=e.split(":"),s=parseInt(t[0]);if(2===t.length)r.set(s,new MeasureText(s,!0,decodeURIComponent(t[1])));else if(3===t.length){var a=t[1].startsWith("b")||t[1].startsWith("s");r.set(s,new MeasureText(s,a,decodeURIComponent(t[2])))}}),r}getGrooveDataFromUrlString(e){var t,r,s,a,n,o=new GrooveData;o.repeatBegins=this.parseIntSet(this.getQueryVariableFromString("RepeatBegins","",e)),o.repeatEnds=this.parseIntSet(this.getQueryVariableFromString("RepeatEnds","",e)),o.repeatEndings=this.parseMeasureMapping(this.getQueryVariableFromString("RepeatEndings","",e)),o.measureText=this.parseTextMapping(this.getQueryVariableFromString("MeasureText","",e)),o.debugMode=parseInt(this.getQueryVariableFromString("Debug",this.debugMode,e),10);var i=this.parseTimeSigString(this.getQueryVariableFromString("TimeSig","4/4",e));for(o.numBeats=i[0],o.noteValue=i[1],o.timeDivision=parseInt(this.getQueryVariableFromString("Div",16,e),10),o.notesPerMeasure=this.calc_notes_per_measure(o.timeDivision,o.numBeats,o.noteValue),o.numberOfMeasures=parseInt(this.getQueryVariableFromString("measures",1,e),10),o.numberOfMeasures<1||isNaN(o.numberOfMeasures)?o.numberOfMeasures=1:o.numberOfMeasures>constant_MAX_MEASURES&&(o.numberOfMeasures=constant_MAX_MEASURES),(t=this.getQueryVariableFromString("Stickings",!1,e))?o.showStickings=!0:(t=this.GetDefaultStickingsGroove(o.notesPerMeasure,o.numBeats,o.noteValue,o.numberOfMeasures),o.showStickings=!1),(r=this.getQueryVariableFromString("H",!1,e))||(this.getQueryVariableFromString("HH",!1,e),r||(r=this.GetDefaultHHGroove(o.notesPerMeasure,o.numBeats,o.noteValue,o.numberOfMeasures))),(s=this.getQueryVariableFromString("S",!1,e))||(s=this.GetDefaultSnareGroove(o.notesPerMeasure,o.numBeats,o.noteValue,o.numberOfMeasures)),(a=this.getQueryVariableFromString("K",!1,e))||(this.getQueryVariableFromString("B",!1,e),a||(a=this.GetDefaultKickGroove(o.notesPerMeasure,o.numBeats,o.noteValue,o.numberOfMeasures))),n=0;n<4;n++){var c=this.getQueryVariableFromString("T"+(n+1),!1,e);c?o.showToms=!0:c=this.GetDefaultTomGroove(o.notesPerMeasure,o.numBeats,o.noteValue,o.numberOfMeasures),o.toms_array[n]=this.noteArraysFromURLData("T"+(n+1),c,o.notesPerMeasure,o.numberOfMeasures)}o.sticking_array=this.noteArraysFromURLData("Stickings",t,o.notesPerMeasure,o.numberOfMeasures),o.hh_array=this.noteArraysFromURLData("H",r,o.notesPerMeasure,o.numberOfMeasures),o.snare_array=this.noteArraysFromURLData("S",s,o.notesPerMeasure,o.numberOfMeasures),o.kick_array=this.noteArraysFromURLData("K",a,o.notesPerMeasure,o.numberOfMeasures),o.title=this.getQueryVariableFromString("title","",e),o.title=decodeURIComponent(o.title),o.title=o.title.replace(/\+/g," "),o.author=this.getQueryVariableFromString("author","",e),o.author=decodeURIComponent(o.author),o.author=o.author.replace(/\+/g," "),o.comments=this.getQueryVariableFromString("comments","",e),o.comments=decodeURIComponent(o.comments),o.comments=o.comments.replace(/\+/g," "),o.tempo=parseInt(this.getQueryVariableFromString("tempo",constant_DEFAULT_TEMPO,e),10),(isNaN(o.tempo)||o.tempo<20||o.tempo>400)&&(o.tempo=constant_DEFAULT_TEMPO);var u=this.getQueryVariableFromString("embedTempoTimeSig",!1,e);return o.embedTempoTimeSig="true"===u||"True"===u,o}get_top_ABC_BoilerPlate(e,t,r,s,a,n,o,i,c,u){var h="%abc\n%%fullsvg _"+this.grooveUtilsUniqueIndex+"\nX:6\n";return h+="M:"+i+"/"+c+"\n",h+="T: "+t+"\n",""!==r&&(h+="C: "+r+"\n",h+="%%musicspace 20px\n"),u<400&&(u=400),u>3e3&&(u=3e3),h+="L:1/32\n",e?h+="%%stretchlast 0\n":h+="%%stretchlast 1\n",h+="%%flatbeams 1\n%%ornament up\n%%pagewidth "+(u=Math.floor(.75*u))+'px\n%%leftmargin 0cm\n%%rightmargin 0.5cm\n%%topspace 10px\n%%titlefont calibri 20\n%%partsfont calibri 16\n%%gchordfont calibri 16\n%%annotationfont calibri 16\n%%infofont calibri 16\n%%textfont calibri 16\n%%deco (. 0 a 5 1 1 "@-8,-3("\n%%deco ). 0 a 5 1 1 "@4,-3)"\n%%beginsvg\n <defs>\n <path id="Xhead" d="m-3,-3 l6,6 m0,-6 l-6,6" class="stroke" style="stroke-width:1.2"/>\n <path id="Trihead" d="m-3,2 l 6,0 l-3,-6 l-3,6 l6,0" class="stroke" style="stroke-width:1.2"/>\n </defs>\n%%endsvg\n%%map drum ^g heads=Xhead print=g       % Hi-Hat\n%%map drum ^c\' heads=Xhead print=c\'   % Crash\n%%map drum ^d\' heads=Xhead print=d\'   % Stacker\n%%map drum ^e\' heads=Xhead print=e\'   % Metronome click\n%%map drum ^f\' heads=Xhead print=f\'   % Metronome beep\n%%map drum ^A\' heads=Xhead print=A\'   % Ride\n%%map drum ^B\' heads=Trihead print=A\' % Ride Bell\n%%map drum ^D\' heads=Trihead print=g   % Cow Bell\n%%map drum ^c heads=Xhead print=c  % Cross Stick\n%%map drum ^d, heads=Xhead print=d,  % Foot Splash\n',o?h+="%%staves (Stickings Hands)\n":h+="%%staves (Stickings Hands Feet)\n",""!==s&&(h+="P: "+s+"\n",h+="%%musicspace 20px\n"),h+="K:C clef=perc\n",a&&(h+='V:Stickings\nx8 x8 x8 x8 x8 x8 x8 x8 ||\nV:Hands stem=up \n%%voicemap drum\n"^Hi-Hat"^g4 "^Open"!open!^g4 "^Crash"^c\'4 "^Stacker"^d\'4 "^Ride"^A\'4 "^Ride Bell"^B\'4 x2 "^Tom"e4 "^Tom"A4 "^Snare"c4 "^Buzz"!///!c4 "^Cross"^c4 "^Ghost  "!(.!!).!c4 "^Flam"{/c}c4  x10 ||\nV:Feet stem=down \n%%voicemap drum\nx52 "^Kick"F4 "^HH foot"^d,4 x4 ||\nT:\n'),h}moveAccentsOrOtherModifiersOutsideOfGroup(e,t){var r=!1,s=e.notes1.lastIndexOf(t);return(s>-1&&(r=!0,e.notes1=e.notes1.replace(t,"")),(s=e.notes2.lastIndexOf(t))>-1&&(r=!0,e.notes2=e.notes2.replace(t,"")),(s=e.notes3.lastIndexOf(t))>-1&&(r=!0,e.notes3=e.notes3.replace(t,"")),r)?t:""}testArrayOfArraysForEquality(e,t,r){for(var s=0;s<e.length;s++)if(void 0!==e[s][t]&&e[s][t]!==r)return!1;return!0}getABCforNote(e,t,r,s){for(var a,n="",o={notes1:"",notes2:"",notes3:""},i=0,c=0;c<e.length;c++)if(void 0!==e[c][t]&&!1!==e[c][t]){a=1;for(var u=t+1;u<t+r;u++)if(this.testArrayOfArraysForEquality(e,u,!1))a++;else break;o.notes1+=e[c][t]+s*a,i++}return i>1?(n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"!accent!"),this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"!accent!"),n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"!plus!"),n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"!open!"),n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"!///!"),this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"["),this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"]"),n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"{/c}"),n+=this.moveAccentsOrOtherModifiersOutsideOfGroup(o,"{/cc}"),n+="["+o.notes1+o.notes2+o.notes3+"]"):n+=o.notes1+o.notes2+o.notes3,n}getABCforRest(e,t,r,s,a){var n="";if(this.testArrayOfArraysForEquality(e,t,!1)){for(var o=1,i=t+1;i<t+r;i++)if(this.testArrayOfArraysForEquality(e,i,!1))o++;else break;a?n+="x"+s*o:n+="z"+s*o}return n}abc_gen_note_grouping_size(e,t,r){var s;return e?12:3==t?8*(4/r):t%6==0&&r%8==0?12*(8/r):8}notesPerMeasureInFullSizeArray(e,t,r){return e?48*(t/r):32*(t/r)}getNoteScaler(e,t,r){var s;return!t||t<1||t>36?(console.log("Error in getNoteScaler, out of range: "+t),s=1):s=this.isTripletDivisionFromNotesPerMeasure(e,t,r)?Math.ceil(this.notesPerMeasureInFullSizeArray(!0,t,r)/e):Math.ceil(this.notesPerMeasureInFullSizeArray(!1,t,r)/e),s}scaleNoteArrayToFullSize(e,t,r,s,a){var n,o=this.getNoteScaler(r,s,a),i=[];if(this.isTripletDivisionFromNotesPerMeasure(r,s,a),1==o)return e;for(n=0;n<t*r*o;n++)i[n]=!1;for(n=0;n<t*r;n++)i[n*o]=e[n];return i}count_active_notes_in_arrays(e,t,r){for(var s=0,a=t;a<t+r;a++)for(var n=0;n<e.length;n++)!1!==e[n][a]&&(s++,n=e.length);return s}snare_HH_kick_ABC_for_triplets(e,t,r,s,a,n,o,i,c,u,h,l,g,m,_,f){var A,B="",C="V:Stickings\n",b="V:Hands stem=up\n%%voicemap drum\n",p="V:Feet stem=down\n%%voicemap drum\n",d=1,v=!1;A=u?[s,r,a]:[s,r],n&&(A=A.concat(n));for(var S=i,$=0;$<o;$++){!v&&(v=!0,f.has(d)&&m.has(d)&&(C+="|:["+f.get(d),b+="|:["+f.get(d)),m.has(d)&&(C+="|:",b+="|:"),f.has(d)&&(C+="["+f.get(d),b+="["+f.get(d)),e.measureText.has(d)&&e.measureText.get(d).begin&&(b+='"'+e.measureText.get(d).text+'"'));var k=48/S,T=k,H=!1;if($%c+k>c&&(k=c-$%o),$%this.abc_gen_note_grouping_size(!0,h,l)==0){if(0==this.count_active_notes_in_arrays(A,$,12))H=!0,C+="x8",b+="z8",$+=11;else if(0==this.count_active_notes_in_arrays(A,$+1,11)){for(var y=$+1;y<$+12;y++)t[y]=!1;C+=this.getABCforRest([t],$,8,1,!0),C+=this.getABCforNote([t],$,8,1),u?(b+=this.getABCforNote(A,$,8,1),p=""):(b+=this.getABCforNote(A,$,8,1),p+=this.getABCforNote([a],$,8,1)),H=!0,$+=11}else if(i>12&&0==this.count_active_notes_in_arrays(A,$+1,5)&&0==this.count_active_notes_in_arrays(A,$+7,5)){for(var N=$;N<=$+6;N+=6){for(var y=N+1;y<N+6;y++)t[y]=!1;C+=this.getABCforRest([t],N,4,1,!0),C+=this.getABCforNote([t],N,4,1),u?(b+=this.getABCforRest(A,N,4,1,!1),b+=this.getABCforNote(A,N,4,1),p=""):(b+=this.getABCforRest(A,N,4,1,!1),b+=this.getABCforNote(A,N,4,1),p+=this.getABCforNote([a],N,4,1))}H=!0,$+=11}else if(48==i&&0==this.count_active_notes_in_arrays(A,$+1,2)&&0==this.count_active_notes_in_arrays(A,$+4,2)&&0==this.count_active_notes_in_arrays(A,$+7,2)&&0==this.count_active_notes_in_arrays(A,$+10,2)){for(var N=$;N<=$+9;N+=3){for(var y=N+1;y<N+3;y++)t[y]=!1;C+=this.getABCforRest([t],N,2,1,!0),C+=this.getABCforNote([t],N,2,1),u?(b+=this.getABCforRest(A,N,2,1,!1),b+=this.getABCforNote(A,N,2,1),p=""):(b+=this.getABCforRest(A,N,2,1,!1),b+=this.getABCforNote(A,N,2,1),p+=this.getABCforNote([a],N,2,1))}H=!0,$+=11}else{var M=i/4;if(48==i){for(var O=!0,F=!0,G=$;G<$+12&&(0<this.count_active_notes_in_arrays(A,G+1,3)&&(O=!1),(0<this.count_active_notes_in_arrays(A,G+1,1)||0<this.count_active_notes_in_arrays(A,G+3,1))&&(F=!1),!1!=O||!1!=F);G+=4);T=k=48/(S=O?12:F?24:i),M=S/4}b+="("+M+":"+M+":"+M}}H||($%T==0&&(C+=this.getABCforRest([t],$,T,1,!0),u?(b+=this.getABCforRest(A,$,T,1,!1),p=""):(b+=this.getABCforRest(A,$,T,1,!1),p+=this.getABCforRest([a],$,T,1,!0))),C+=this.getABCforNote([t],$,k,1),u?(b+=this.getABCforNote(A,$,k,1),p=""):(b+=this.getABCforNote(A,$,k,1),p+=this.getABCforNote([a],$,k,1))),$%this.abc_gen_note_grouping_size(!0,h,l)==this.abc_gen_note_grouping_size(!0,h,l)-1&&(C+=" ",b+=" ",p+=" "),($+1)%(12*h*(4/l))==0&&(p+="|",e.measureText.has(d)&&!e.measureText.get(d).begin&&(b+='"'+e.measureText.get(d).text+'"'),_.has(d)?(b+=":|",C+=":|"):(b+="|",C+="|"),d+=1,v=!1,$<o-1&&($+1)%(12*h*(4/l)*g)==0&&(C+="\n",b+="\n",p+="\n"))}return C+=C.endsWith("|")?"\n":"|\n",b+=b.endsWith("|")?"\n":"|\n",p+=p.endsWith("|")?"\n":"|\n",u?B+=C+b:B+=C+b+p,B}snare_HH_kick_ABC_for_quads(e,t,r,s,a,n,o,i,c,u,h,l,g,m,_,f){var A="",B="V:Stickings\n",C="V:Hands stem=up\n%%voicemap drum\n",b="V:Feet stem=down\n%%voicemap drum\n",p=1,d=!1;S=[s,r],n&&(S=S.concat(n)),u&&(S=S.concat([a]));for(var v=0;v<o;v++){!d&&(d=!0,f.has(p)&&m.has(p)&&(B+="|:["+f.get(p),C+="|:["+f.get(p)),m.has(p)&&(B+="|:",C+="|:"),f.has(p)&&(B+="["+f.get(p),C+="["+f.get(p)),e.measureText.has(p)&&e.measureText.get(p).begin&&(C+='"'+e.measureText.get(p).text+'"'));var S,$,k=this.abc_gen_note_grouping_size(!1,h,l);v%c+k>c&&(k=c-v%c),$=v%this.abc_gen_note_grouping_size(!1,h,l)==0?this.abc_gen_note_grouping_size(!1,h,l):this.abc_gen_note_grouping_size(!1,h,l)-v%this.abc_gen_note_grouping_size(!1,h,l),v%c+$>c&&($=c-v%c),v%this.abc_gen_note_grouping_size(!1,h,l)==0&&(B+=this.getABCforRest([t],v,k,1,!0),u?(C+=this.getABCforRest(S,v,k,1,!1),b=""):(C+=this.getABCforRest(S,v,k,1,!1),b+=this.getABCforRest([a],v,k,1,!1))),B+=this.getABCforNote([t],v,$,1),u?(C+=this.getABCforNote(S,v,$,1),b=""):(C+=this.getABCforNote(S,v,$,1),b+=this.getABCforNote([a],v,$,1)),v%this.abc_gen_note_grouping_size(!1,h,l)==this.abc_gen_note_grouping_size(!1,h,l)-1&&(B+=" ",C+=" ",b+=" "),(v+1)%(32/l*h)==0&&(e.measureText.has(p)&&!e.measureText.get(p).begin&&(C+='"'+e.measureText.get(p).text+'"'),b+="|",_.has(p)?(C+=":|",B+=":|"):(C+="|",B+="|"),p+=1,d=!1),v<o-1&&(v+1)%(32/l*h*g)==0&&(B+="\n",C+="\n",b+="\n")}return B+=B.endsWith("|")?"\n":"|\n",C+=C.endsWith("|")?"\n":"|\n",b+=b.endsWith("|")?"\n":"|\n",u?A+=B+C:A+=B+C+b,A}figure_out_sticking_count_for_index(e,t,r,s){var a=e%t,n=0,o=r*(4/s);switch(o){case 4:n=a+1;break;case 8:n=a%2==0?Math.floor(a/2)+1:"&";break;case 12:n=a%3==0?Math.floor(a/3)+1:a%3==1?"&":"a";break;case 24:n=a%3==0?Math.floor(a/6)+1:a%3==1?"&":"a";break;case 48:n=a%3==0?Math.floor(a/12)+1:a%3==1?"&":"a";break;default:n=a%4==0?Math.floor(a/(o/4))+1:a%4==1?"e":a%4==2?"&":"a"}return n}convert_sticking_counts_to_actual_counts(e,t,r,s){var a=32;this.isTripletDivision(t)&&(a=48);var n=this.calc_notes_per_measure(a,r,s),o=t/4*r*(4/s);for(var i in e)if(e[i]==constant_ABC_STICK_COUNT){var c=Math.floor(i/(n/o)),u='"'+this.figure_out_sticking_count_for_index(c,o,t,s)+'"x';e[i]=u}}create_ABC_from_snare_HH_kick_arrays(e,t,r,s,a,n,o,i,c,u,h,l,g,m,_){this.convert_sticking_counts_to_actual_counts(t,i,h,l);var f=2;return(c>=32&&(f=1),this.isTripletDivisionFromNotesPerMeasure(c,h,l))?this.snare_HH_kick_ABC_for_triplets(e,t,r,s,a,n,o,i,c,u,h,l,f,g,m,_):this.snare_HH_kick_ABC_for_quads(e,t,r,s,a,n,o,i,c,u,h,l,f,g,m,_)}createABCFromGrooveData(e,t){for(var r=this.scaleNoteArrayToFullSize(e.sticking_array,e.numberOfMeasures,e.notesPerMeasure,e.numBeats,e.noteValue),s=this.scaleNoteArrayToFullSize(e.hh_array,e.numberOfMeasures,e.notesPerMeasure,e.numBeats,e.noteValue),a=this.scaleNoteArrayToFullSize(e.snare_array,e.numberOfMeasures,e.notesPerMeasure,e.numBeats,e.noteValue),n=this.scaleNoteArrayToFullSize(e.kick_array,e.numberOfMeasures,e.notesPerMeasure,e.numBeats,e.noteValue),o=[],i=0;i<constant_NUMBER_OF_TOMS;i++)o[i]=this.scaleNoteArrayToFullSize(e.toms_array[i],e.numberOfMeasures,e.notesPerMeasure,e.numBeats,e.noteValue);var c=this.isTripletDivisionFromNotesPerMeasure(e.notesPerMeasure,e.numBeats,e.noteValue),u=this.get_top_ABC_BoilerPlate(!1,e.title,e.author,e.comments,e.showLegend,c,e.kickStemsUp,e.numBeats,e.noteValue,t);return u+this.create_ABC_from_snare_HH_kick_arrays(e,r,s,a,n,o,s.length,e.timeDivision,this.notesPerMeasureInFullSizeArray(c,e.numBeats,e.noteValue),e.kickStemsUp,e.numBeats,e.noteValue,e.repeatBegins,e.repeatEnds,e.repeatEndings)}renderABCtoSVG(e){return this.abc_obj=new Abc(this.abcToSVGCallback),this.myGrooveData&&this.myGrooveData.showLegend||this.isLegendVisable?this.abcNoteNumIndex=-15:this.abcNoteNumIndex=0,this.abcToSVGCallback.abc_svg_output="",this.abcToSVGCallback.abc_error_output="",this.abc_obj.tosvg("SOURCE",e),{svg:this.abcToSVGCallback.abc_svg_output,error_html:this.abcToSVGCallback.abc_error_output}}}